rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    function isAdmin() {
      return request.auth != null && request.auth.token.email == "admin@tablebites.com";
    }

    match /restaurants/{restaurantId} {
      // Allow admins to list and read orders.
      // This rule allows the query being made by the admin dashboard.
      allow list, read: if isAdmin();

      // Allow any authenticated user (including anonymous users) to create an order.
      allow create: if request.auth != null;

      // Allow admins to update or delete any order.
      allow update, delete: if isAdmin();

      // Rules for the orderItems subcollection can be added here if needed.
      match /orders/{orderId}/orderItems/{orderItemId} {
          allow read, write: if isAdmin();
      }
    }
  }
}
